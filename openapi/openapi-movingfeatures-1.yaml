openapi: 3.0.3
info:
  title: "Building Blocks specified in OGC API - Moving Features - Part 1: Core"
  version: 0.1.0
  description: >-
    This is the OpenAPI definition of Moving Features API specification that conforms to the OGC Moving Features Encoding Extension - JSON.
  contact:
    name: Taehoon Kim
    email: kim.taehoon@aist.go.jp
  license:
    name: OGC License
    url: "https://www.ogc.org/ogc/Document"
  x-logo:
    url: "https://www.ogc.org/pub/www/files/OGC_Logo_2D_Blue_x_0_0.png"
    backgroundColor: "#FFFFFF"
    altText: "OGC logo"
    href: "https://www.ogc.org/contacts"

tags:
  - name: Capabilities
    description: Essential characteristics of the information available from the API.
  - name: MovingFeatureCollection
    description: Collections of moving features to be logically managed by a user.
  - name: MovingFeatures
    description: Moving feature data, including the temporal geometry, temporal properties, etc.
  - name: TemporalGeometry
    description: The spatial change over time (temporal geometry), representing the movement of the rigid or nonrigid body of a feature.
  - name: TemporalGeometryQuery
    description: Queryable resources for the temporal primitive geometry.
  - name: TemporalProperty
    description: The thematic change over time (temporal property), representing the variation of the value of any descriptive characteristic of a feature.
paths:
  /:
    get:
      operationId: getLandingPage
      summary: Landing page
      description: The landing page provides links to the API definition, the conformance statements and to the feature collections in this dataset.
      tags:
        - Capabilities
      responses:
        '200':
          $ref: "responses/LandingPage.yaml"
        '500':
          $ref: "responses/ServerError.yaml"

  /conformance:
    get:
      operationId: getConformance
      summary: Information about specifications that this API conforms to
      description: A list of all conformance classes specified in a standard that the server conforms to.
      tags:
        - Capabilities
      responses:
        '200':
          $ref: "responses/Conformance.yaml"
        '500':
          $ref: "responses/ServerError.yaml"

  /api:
    get:
      operationId: getAPIList
      summary: API definition
      description: A list of all API definition
      tags:
        - Capabilities
      responses:
        '200':
          description: A list of all API definition generated by Open API Specification
          content:
            application/json:
              example:
                $ref: "openapi-movingfeatures-1.json"
        '500':
          $ref: "responses/ServerError.yaml"

  /collections:
    get:
      operationId: searchCatalog
      summary: Retrieve catalogs of moving features collection
      description: |
        A user can retrieve catalogs to access collections by simple filtering and a limit.
      tags:
        - Capabilities
      responses:
        '200':
          $ref: "responses/Collections.yaml"
        '500':
          $ref: "responses/ServerError.yaml"
    post:
      operationId: registerMetadata
      summary: Register metadata about a collection of moving features
      description: |
        A user SHOULD register metadata about a collection of moving features into the system.
      tags:
        - MovingFeatureCollection
      requestBody:
        content:
          application/json:
            schema:
              $ref: "schemas/requestBody/collection.yaml"
            example:
              $ref: "examples/collections_post.json"
      responses:
        '201':
          description: Successful create a collection to manage moving features.
          headers:
            Location:
              description: A URI of the newly added resource
              schema:
                type: string
                example: "https://data.example.org/collections/mfc1"
          content:
            application/json:
              schema:
                type: object
                required:
                  - id
                properties:
                  id:
                    type: string
                    description: "Newly added resource ID"
                example: { "id": "mfc-1" }
        '500':
          $ref: "responses/ServerError.yaml"

  /collections/{collectionId}:
    get:
      operationId: accessMetadata
      summary: Access metadata about the collection
      description: |
        A user can access metadata with id `collectionId`.
      tags:
        - MovingFeatureCollection
      parameters:
        - $ref: "parameters/collectionId.yaml"
      responses:
        '200':
          $ref: "responses/Collection.yaml"
        '404':
          description: A collection with the specified id was not found.
        '500':
          $ref: "responses/ServerError.yaml"
    delete:
      operationId: deleteCollection
      summary: Delete the collection
      description: |
        The collection catalog with id `collectionId` and including metadata and moving features SHOULD be deleted.
      tags:
        - MovingFeatureCollection
      parameters:
        - $ref: "parameters/collectionId.yaml"
      responses:
        '204':
          description: Successfully deleted.
        '404':
          description: A collection with the specified name was not found.
        '500':
          $ref: "responses/ServerError.yaml"
    put:
      operationId: replaceMetadata
      summary: Replace metadata about the collection
      description: |
        A user SHOULD replace metadata with id `collectionId`.
        
        The request body schema is the same the POST's one. 
        
        However, `updateFrequency` property is NOT updated.
      tags:
        - MovingFeatureCollection
      parameters:
        - $ref: "parameters/collectionId.yaml"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "schemas/requestBody/collection.yaml"
            example:
              $ref: "examples/collections_post.json"
      responses:
        '204':
          description: Successfully replaced.
        '404':
          description: A collection with the specified name was not found.
        '500':
          $ref: "responses/ServerError.yaml"

  /collections/{collectionId}/items:
    get:
      operationId: retrieveMovingFeatures
      summary: Retrieve moving feature collection
      description: |
        A user can retrieve moving feature collection to access the static information of the moving feature by simple filtering and a limit.
        
        Specifically, if the `subTrajectory` parameter is "true", it will return the temporal geometry within the time interval specified by `datetime` parameter.
      tags:
        - MovingFeatures
      parameters:
        - $ref: "parameters/collectionId.yaml"
        - $ref: "parameters/bbox.yaml"
        - $ref: "parameters/datetime.yaml"
        - $ref: "parameters/limit.yaml"
        - $ref: "parameters/subtrajectory-description.yaml"
      responses:
        '200':
          $ref: "responses/MovingFeatures.yaml"
        '404':
          description: A collection with the specified id was not found.
        '500':
          $ref: "responses/ServerError.yaml"
    post:
      operationId: insertMovingFeatures
      summary: Insert moving features
      description: |
        A user SHOULD insert a set of moving features or a moving feature into a collection with id `collectionId`.

        The request body schema SHALL follows the [MovingFeature object](https://docs.opengeospatial.org/is/19-045r3/19-045r3.html#mfeature) or 
        [MovingFeatureCollection object](https://docs.opengeospatial.org/is/19-045r3/19-045r3.html#mfeaturecollection) in the OGC MF-JSON.
      tags:
        - MovingFeatures
      parameters:
        - $ref: "parameters/collectionId.yaml"
      requestBody:
        content:
          application/json:
            schema:
#              $ref: "schemas/MF-JSON/Prism/movingFeature.yaml"
              oneOf:
#                - $ref: "schemas/MF-JSON/Prism/movingFeature.yaml"
#                - $ref: "schemas/MF-JSON/Prism/movingFeatureCollection.yaml"
                - $ref: "https://schemas.opengis.net/movingfeatures/1.0/MF-JSON_Prism.schema.json#/definitions/movingFeature"
                - $ref: "https://schemas.opengis.net/movingfeatures/1.0/MF-JSON_Prism.schema.json#/definitions/movingFeatureCollection"
            example:
              $ref: "examples/movingFeature_MF_JSON.json"
      responses:
        '201':
          description: |
            Successful create a set of moving features or a moving feature into a specific collection.
          headers:
            Location:
              description: A list of URI of the newly added resources
              schema:
                type: array
                items:
                  type: string
                example:
                  - "https://data.example.org/collections/mfc-1/items/mf-1"
                  - "https://data.example.org/collections/mfc-1/items/109301273"
        '400':
          description: A query parameter was not validly used.
        '404':
          description: A collection with the specified id was not found.
        '500':
          $ref: "responses/ServerError.yaml"

  /collections/{collectionId}/items/{mFeatureId}:
    get:
      operationId: accessMovingFeature
      summary: Access the static data of the moving feature
      description: |
        A user can access a static data of a moving feature with id `mFeatureId`.

        The static data of a moving feature is not included temporal geometries and temporal properties.
      tags:
        - MovingFeatures
      parameters:
        - $ref: "parameters/collectionId.yaml"
        - $ref: "parameters/mFeatureId.yaml"
      responses:
        '200':
          $ref: "responses/MovingFeature.yaml"
        '404':
          description: |
            - A collection with the specified id was not found.
            - Or a moving feature with the specified id was not found.
        '500':
          $ref: "responses/ServerError.yaml"
    delete:
      operationId: deleteMovingFeature
      summary: Delete a single moving feature
      description: |
        The moving feature with id `mFeatureId` and including temporal geometries and properties SHOULD be deleted.
      tags:
        - MovingFeatures
      parameters:
        - $ref: "parameters/collectionId.yaml"
        - $ref: "parameters/mFeatureId.yaml"
      responses:
        '204':
          description: Successfully deleted.
        '404':
          description: |
            - A collection with the specified id was not found.
            - Or a moving feature with the specified id was not found.
        '500':
          $ref: "responses/ServerError.yaml"

  /collections/{collectionId}/items/{mFeatureId}/tgsequence:
    get:
      operationId: retrieveTemporalGeometrySequence
      summary: Retrieve the movement data of the single moving feature
      description: |
        A user can retrieve only the movement data of a moving feature with id `mFeatureId` by simple filtering and a limit.

#        TODO: additional explanation of each parameter / warning for using both leaf and subtrajecotry
      tags:
        - TemporalGeometry
      parameters:
        - $ref: "parameters/collectionId.yaml"
        - $ref: "parameters/mFeatureId.yaml"
        - $ref: "parameters/bbox.yaml"
        - $ref: "parameters/datetime.yaml"
        - $ref: "parameters/limit.yaml"
        - $ref: "parameters/leaf-description.yaml"
        - $ref: "parameters/subtrajectory-description.yaml"
      responses:
        '200':
          $ref: "responses/TemporalGeometrySequence.yaml"
        '500':
          $ref: "responses/ServerError.yaml"
    post:
      operationId: insertTemporalPrimitiveGeometry
      summary: Add movement data into the moving feature
      description: |
        A user SHOULD add more movement data into a moving feature with id `mFeatureId`.

        The request body schema SHALL follows the [TemporalPrimitiveGeometry object](https://docs.ogc.org/is/19-045r3/19-045r3.html#tprimitive) in the OGC MF-JSON.
      tags:
        - TemporalGeometry
      parameters:
        - $ref: "parameters/collectionId.yaml"
        - $ref: "parameters/mFeatureId.yaml"
      requestBody:
        content:
          application/json:
            schema:
#              $ref: "schemas/MF-JSON/Prism/temporalPrimitiveGeometry.yaml"
              $ref: "https://schemas.opengis.net/movingfeatures/1.0/MF-JSON_Prism.schema.json#/definitions/temporalPrimitiveGeometry"
            example:
              $ref: "examples/temporalPrimitiveGeometry.json"
      responses:
        '201':
          description: |
            Successful add more movement data into a specified moving feature.
          headers:
            Location:
              description: A URI of the newly added resource
              schema:
                type: string
                example: "https://data.example.org/collections/mfc-1/items/mf-1/tgsequence/tg-2"
        '400':
          description: A query parameter was not validly used.
        '404':
          description: |
            - A collection with the specified id was not found.
            - Or a moving feature with the specified id was not found.
        '500':
          $ref: "responses/ServerError.yaml"

  /collections/{collectionId}/items/{mFeatureId}/tgsequence/{tGeometryId}:
    delete:
      operationId: deleteTemporalPrimitiveGeometry
      summary: Delete a singe temporal primitive geometry
      description: |
        The temporal primitive geometry with id `tGeometryId` SHOULD be deleted.
      tags:
        - TemporalGeometry
      parameters:
        - $ref: "parameters/collectionId.yaml"
        - $ref: "parameters/mFeatureId.yaml"
        - $ref: "parameters/tGeometryId.yaml"
      responses:
        '204':
          description: Successfully deleted.
        '404':
          description: |
            - A collection with the specified id was not found.
            - Or a moving feature with the specified id was not found.
            - Or a temporal primitive geometry with the specified id was not found.
        '500':
          $ref: "responses/ServerError.yaml"

  /collections/{collectionId}/items/{mFeatureId}/tgsequence/{tGeometryId}/distance:
    get:
      operationId: getDistanceOfTemporalPrimitiveGeometry
      summary: Get a time-to-distance curve of a temporal primitive geometry
      description: |
        A user can get time-to-distance curve of a temporal primitive geometry with id `tGeometryId`.
        
        When `date-time` query parameter is provided, this operation will return a single distance value according to the specified date and time in the `data-time` parameter.
      tags:
        - TemporalGeometryQuery
      parameters:
        - $ref: "parameters/collectionId.yaml"
        - $ref: "parameters/mFeatureId.yaml"
        - $ref: "parameters/tGeometryId.yaml"
        - $ref: "parameters/date-time.yaml"
      responses:
        '200':
          $ref: "responses/DistanceQuery.yaml"
        '400':
          description: A query parameter was not validly used.
        '500':
          $ref: "responses/ServerError.yaml"

  /collections/{collectionId}/items/{mFeatureId}/tgsequence/{tGeometryId}/velocity:
    get:
      operationId: getVelocityOfTemporalPrimitiveGeometry
      summary: Get a time-to-velocity curve of a temporal primitive geometry
      description: |
        A user can get time-to-velocity curve of a temporal primitive geometry with id `tGeometryId`.
        
        When `date-time` query parameter is provided, this operation will return a single velocity value according to the specified date and time in the `data-time` parameter.
      tags:
        - TemporalGeometryQuery
      parameters:
        - $ref: "parameters/collectionId.yaml"
        - $ref: "parameters/mFeatureId.yaml"
        - $ref: "parameters/tGeometryId.yaml"
        - $ref: "parameters/date-time.yaml"
      responses:
        '200':
          $ref: "responses/VelocityQuery.yaml"
        '400':
          description: A query parameter was not validly used.
        '500':
          $ref: "responses/ServerError.yaml"

  /collections/{collectionId}/items/{mFeatureId}/tgsequence/{tGeometryId}/acceleration:
    get:
      operationId: getAccelerationOfTemporalPrimitiveGeometry
      summary: Get a time-to-acceleration curve of a temporal primitive geometry
      description: |
        A user can get time-to-acceleration curve of a temporal primitive geometry with id `tGeometryId`.
        
        When `date-time` query parameter is provided, this operation will return a single acceleration value according to the specified date and time in the `data-time` parameter.
      tags:
        - TemporalGeometryQuery
      parameters:
        - $ref: "parameters/collectionId.yaml"
        - $ref: "parameters/mFeatureId.yaml"
        - $ref: "parameters/tGeometryId.yaml"
        - $ref: "parameters/date-time.yaml"
      responses:
        '200':
          $ref: "responses/AccelerationQuery.yaml"
        '400':
          description: A query parameter was not validly used.
        '500':
          $ref: "responses/ServerError.yaml"

  /collections/{collectionId}/items/{mFeatureId}/tproperties:
    get:
      operationId: retrieveTemporalProperties
      summary: Retrieve a set of the temporal property data
      description: |
        A user can retrieve the static information of the temporal property data that included a single moving feature with id `mFeatureId`.
        
        The static data of a temporal property is not included temporal values (property `valueSequence`).
        
        Also a user can retrieve the sub sequence of the temporal information of the temporal property data for the specified time interval with `subTemporalValue` query parameter. 
        In this case, `temporalProperties` property schema SHALL follows the [TemporalProperties object](https://docs.ogc.org/is/19-045r3/19-045r3.html#tproperties) in the OGC MF-JSON.
      tags:
        - TemporalProperty
      parameters:
        - $ref: "parameters/collectionId.yaml"
        - $ref: "parameters/mFeatureId.yaml"
        - $ref: "parameters/datetime.yaml"
        - $ref: "parameters/limit.yaml"
        - $ref: "parameters/subtemporalvalue-description.yaml"
      responses:
        '200':
          $ref: "responses/TemporalProperties.yaml"
        '400':
          description: A query parameter was not validly used.
        '500':
          $ref: "responses/ServerError.yaml"
    post:
      operationId: insertTemporalProperty
      summary: Add temporal property data
      description: |
        A user SHOULD add new temporal property data into a moving feature with id `mFeatureId`.
        
        The request body schema SHALL follows the [TemporalProperties object](https://docs.opengeospatial.org/is/19-045r3/19-045r3.html#tproperties) in the OGC MF-JSON.
      tags:
        - TemporalProperty
      parameters:
        - $ref: "parameters/collectionId.yaml"
        - $ref: "parameters/mFeatureId.yaml"
      requestBody:
        content:
          application/json:
            schema:
#              $ref: "schemas/MF-JSON/Prism/temporalProperties.yaml"
              $ref: "https://schemas.opengis.net/movingfeatures/1.0/MF-JSON_Prism.schema.json#/definitions/temporalProperties"
            example:
              $ref: "examples/temporalProperty_MF_JSON.json"
      responses:
        '201':
          description: |
            Successful add more temporal property into a specified moving feature.
          headers:
            Locations:
              description: A list of URI of the newly added resources
              schema:
                type: array
                items:
                  type: string
                example:
                  - "https://data.example.org/collections/mfc-1/items/mf-1/tproperties/length"
                  - "https://data.example.org/collections/mfc-1/items/mf-1/tproperties/discharge"
                  - "https://data.example.org/collections/mfc-1/items/mf-1/tproperties/camera"
                  - "https://data.example.org/collections/mfc-1/items/mf-1/tproperties/labels"
        '404':
          description: |
            - A collection with the specified id was not found.
            - Or a moving feature with the specified id was not found.
        '500':
          $ref: "responses/ServerError.yaml"

  /collections/{collectionId}/items/{mFeatureId}/tproperties/{tPropertyName}:
    get:
      operationId: retrieveTemporalProperty
      summary: Retrieve a temporal property
      description: |
        A user can retrieve only the temporal values with a specified name `tPropertyName` of temporal property.
      tags:
        - TemporalProperty
      parameters:
        - $ref: "parameters/collectionId.yaml"
        - $ref: "parameters/mFeatureId.yaml"
        - $ref: "parameters/tPropertyName.yaml"
        - $ref: "parameters/datetime.yaml"
#        - $ref: "parameters/limit.yaml"
        - $ref: "parameters/leaf-description.yaml"
        - $ref: "parameters/subtemporalvalue-description.yaml"
      responses:
        '200':
          $ref: "responses/TemporalProperty.yaml"
        '400':
          description: A query parameter was not validly used.
        '500':
          $ref: "responses/ServerError.yaml"
    post:
      operationId: insertTemporalPrimitiveValue
      summary: Add temporal primitive value data
      description: |
        A user SHOULD add more temporal primitive value data into a temporal property with id `tPropertyName`.
      tags:
        - TemporalProperty
      parameters:
        - $ref: "parameters/collectionId.yaml"
        - $ref: "parameters/mFeatureId.yaml"
        - $ref: "parameters/tPropertyName.yaml"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "schemas/temporalPrimitiveValue.yaml"
            example:
              $ref: "examples/temporalPrimitiveValue.json"
      responses:
        '201':
          description: |
            Successful add more temporal primitive value data into a specified temporal property.
#          headers:
#            Location:
#              description: A URI of the newly added resource
#              schema:
#                type: string
#                example: "https://data.example.org/collections/mfc-1/items/mf-1/tproperties/tp-1/tvalue/tv-1"
        '404':
          description: |
            - A collection with the specified id was not found.
            - Or a moving feature with the specified id was not found.
            - Or a temporal property with the specified id was not found.
        '500':
          $ref: "responses/ServerError.yaml"

    delete:
      operationId: deleteTemporalProperty
      summary: Delete a specified temporal property
      description: |
        The temporal property with id `tPropertyName` SHOULD be deleted.
      tags:
        - TemporalProperty
      parameters:
        - $ref: "parameters/collectionId.yaml"
        - $ref: "parameters/mFeatureId.yaml"
        - $ref: "parameters/tPropertyName.yaml"
      responses:
        '204':
          description: Successfully deleted.
        '404':
          description: |
            - A collection with the specified id was not found.
            - Or a moving feature with the specified id was not found.
            - Or a temporal property with the specified id was not found.
        '500':
          $ref: "responses/ServerError.yaml"